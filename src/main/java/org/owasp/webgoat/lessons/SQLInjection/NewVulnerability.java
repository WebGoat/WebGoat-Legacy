package org.owasp.webgoat.lessons.SQLInjection;

import org.owasp.webgoat.session.WebSession;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

public class NewVulnerability {


    public boolean login(WebSession s, String userId, String password)
    {
        // System.out.println("Logging in to lesson");
        boolean authenticated = false;

        try
        {
            String query = "SELECT * FROM employee WHERE userid = " + userId + " and password = '" + password + "'";
            // System.out.println("Query:" + query);
            try
            {
                Statement answer_statement = WebSession.getConnection(s)
                        .createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);
                ResultSet answer_results = answer_statement.executeQuery(query);
                if (answer_results.first())
                {
                    authenticated = true;
                }
            } catch (SQLException sqle)
            {
                s.setMessage("Error logging in");
                sqle.printStackTrace();
            }
        } catch (Exception e)
        {
            s.setMessage("Error logging in");
            e.printStackTrace();
        }

        // System.out.println("Lesson login result: " + authenticated);
        return authenticated;
    }
}
